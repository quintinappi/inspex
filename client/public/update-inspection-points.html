<!DOCTYPE html>
<html>
<head>
  <title>Update Inspection Points</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
    }
    button {
      background: #2563eb;
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
    }
    button:hover {
      background: #1d4ed8;
    }
    button:disabled {
      background: #9ca3af;
      cursor: not-allowed;
    }
    #log {
      margin-top: 20px;
      padding: 15px;
      background: #f3f4f6;
      border-radius: 6px;
      font-family: monospace;
      white-space: pre-wrap;
    }
    .success { color: #10b981; }
    .error { color: #ef4444; }
    .info { color: #3b82f6; }
  </style>
</head>
<body>
  <h1>Update Inspection Points</h1>
  <p>This will delete all existing inspection points and add the new 13-point checklist.</p>
  <button onclick="updatePoints()" id="updateBtn">Update Inspection Points</button>
  <div id="log"></div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, collection, getDocs, deleteDoc, addDoc, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyCv3YaxHhB-aZnNg5gr-kXtkvz7j6GNyXo",
      authDomain: "inspex001.firebaseapp.com",
      projectId: "inspex001",
      storageBucket: "inspex001.firebasestorage.app",
      messagingSenderId: "645714761263",
      appId: "1:645714761263:web:f3edf55cd460766b6c18da"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const inspectionPoints = [
      {
        name: 'Confirm Drawing Number used by Fabricator',
        description: '',
        order_index: 1
      },
      {
        name: 'Confirm Over-All Dimensions',
        description: '',
        order_index: 2
      },
      {
        name: 'Confirm Member Sizes as per Drawing',
        description: 'As Per Drawing',
        order_index: 3
      },
      {
        name: 'Confirm Plate Thickness',
        description: 'HP=6mm / LP=3mm (140 kPa - HP & LP=3mm)',
        order_index: 4
      },
      {
        name: 'Confirm Welding on Structural Members. Size and Quality',
        description: '6mm (100 x 200 space Weld)',
        order_index: 5
      },
      {
        name: 'Confirm Welding on Hinges. Size and Quality',
        description: '8mm',
        order_index: 6
      },
      {
        name: 'Confirm Hinge Plate Thickness',
        description: '8mm',
        order_index: 7
      },
      {
        name: 'Confirm Hinge Pin Dimension',
        description: 'M24 x 200 (M20 for 140 kPa Door)',
        order_index: 8
      },
      {
        name: 'Check for General fit, excessive Gaps between frame and door.',
        description: '',
        order_index: 9
      },
      {
        name: 'Door cleaned of all spatter and welding defects',
        description: '',
        order_index: 10
      },
      {
        name: 'Grease nipples fitted to all hinges',
        description: '',
        order_index: 11
      },
      {
        name: 'Door Functionality & Smooth operation.',
        description: '',
        order_index: 12
      },
      {
        name: 'Silicone added to the inside joints to insure a water/ airtight seal',
        description: '',
        order_index: 13
      }
    ];

    function log(message, type = 'info') {
      const logEl = document.getElementById('log');
      const span = document.createElement('span');
      span.className = type;
      span.textContent = message + '\n';
      logEl.appendChild(span);
    }

    window.updatePoints = async function() {
      const btn = document.getElementById('updateBtn');
      btn.disabled = true;
      document.getElementById('log').innerHTML = '';

      try {
        log('üóëÔ∏è  Deleting old inspection points...', 'info');

        // Delete all existing points
        const existingSnapshot = await getDocs(collection(db, 'inspection_points'));

        for (const doc of existingSnapshot.docs) {
          await deleteDoc(doc.ref);
        }

        log(`‚úÖ Deleted ${existingSnapshot.size} old points\n`, 'success');

        log('üå± Adding new inspection points...', 'info');

        // Add new points
        for (const point of inspectionPoints) {
          await addDoc(collection(db, 'inspection_points'), point);
          log(`‚úÖ ${point.order_index}. ${point.name}`, 'success');
        }

        log(`\nüéâ Successfully updated inspection points!\n`, 'success');

        // Verify
        const verifyQuery = query(
          collection(db, 'inspection_points'),
          orderBy('order_index')
        );
        const verifySnapshot = await getDocs(verifyQuery);

        log('üìã Verification - Current points in database:', 'info');
        verifySnapshot.docs.forEach(doc => {
          const data = doc.data();
          log(`   ${data.order_index}. ${data.name}`, 'info');
        });

        log('\n‚úÖ DONE! Refresh your inspection page to see the changes.', 'success');

      } catch (error) {
        log(`‚ùå Error: ${error.message}`, 'error');
        console.error(error);
      } finally {
        btn.disabled = false;
      }
    };
  </script>
</body>
</html>
